<?xml version="1.0" encoding="UTF-8"?>
<actions>


<meta>
  <description>Template für die standardisierte SRU-API für Suche in Katalogen</description>
  <variable name="baseurl"><description>Url des Servers, inklusive Protokoll</description></variable>
  <variable name="searchKeys" default="dc.title;dc.creator;dc.identifier;dc.date;dc.subject"><description>zu verwendende Suchschlüssel</description></variable>
</meta>

<action id="search-connect"></action>

<action id="search">
  
  <variable name="maximumRecords">15</variable>
  <variable name="recordSchema">get("recordSchema", "dc")</variable>

  <variable name="searchKey">
  tokenize(get("searchKeys", "dc.title;dc.creator;dc.identifier;dc.date;dc.subject"), ";")
  </variable>
  
  <variable name="query">
  encode-for-uri( string-join(
    (if ($book.title != "")    then concat($searchKey[1], "=", $book.title)    else (),
     if ($book.author != "")   then concat($searchKey[2], "=", $book.author)   else (),
     if ($book.isbn != "")     then concat($searchKey[3], "=", $book.isbn)     else (),
     if ($book.year != "")     then concat($searchKey[4], "=", $book.year)     else (),
     if ($book.keywords != "") then concat($searchKey[5], "=", $book.keywords) else ()), " AND "))
  </variable>

  <variable name="position">1</variable>

  <page url="{$baseurl}?version=1.1&operation=searchRetrieve&query={$query}&maximumRecords={$maximumRecords}&recordSchema={$recordSchema}" templateFile="list"/>
</action>

<action id="search-next-page">
  <variable name="position">$position + $maximumRecords</variable>
  <page url="{$baseurl}?version=1.1&operation=searchRetrieve&query={$query}&maximumRecords={$maximumRecords}&recordSchema={$recordSchema}&startRecord={$position}" templateFile="list"/>
</action>

<action id="search-details">
</action>

</actions>
