<html>
<template:meta default-text-matching="regex"/>
{if (get("singleBookResult", "") != "") then book := {"_detail-url": $url} else ()}

<div class="box">
  <td>
    <strong>Signatur|Regalstandort</strong>{$book.id := text()}
  </td>?
  <img alt="Buchcover">{book.image-url := resolve-uri(@src)}</img>?
</div>?

<div t:condition="@id=('tab-content', 'detailsTabs-titleinfo', 'box-container')">
  <template:switch prioritized="on">
    <table class="data2">
      <template:loop><template:switch>
      <tr><td>^(Titel|Title):</td><td>{$book.title}</td></tr>
      <tr><td>^Autor|Verfasser</td><td>{$book.author}</td></tr>
      <tr><td>^Ort:</td><td>{$book.location}</td></tr>
      <tr><td>^Verlag:</td><td>{$book.publisher}</td></tr>
      <tr><td>^Jahr:</td><td>{$book.year}</td></tr>
      <tr><td>^ISBN:</td><td>{$book.isbn}</td></tr>
      <tr><td>{$temp}</td><td>{$book($temp||"!") := .}</td></tr>
      </template:switch></template:loop>
    </table>

    <table t:condition="@class=('fulltitle','titleinfo')">
      <template:loop><template:switch>
      <tr><th>^(Titel|Title):</th><td>{$book.title}</td></tr>
      <tr><th>^Autor|Verfasser</th><td>{$book.author}</td></tr>
      <tr><th>^Ort:</th><td>{$book.location}</td></tr>
      <tr><th>^Verlag:</th><td>{$book.publisher}</td></tr>
      <tr><th>^Jahr:</th><td>{$book.year}</td></tr>
      <tr><th>^ISBN:</th><td>{$book.isbn}</td></tr>
      <tr><th>{$temp}</th><td>{$book($temp||"!") := .}</td></tr>
      </template:switch></template:loop>
    </table>
    
    <table class="data">
    <td>
    <template:loop><template:switch>
      <strong>^Titelzusatz<t:s>$book.title:= concat($book.title, " ", (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1])</t:s></strong>
      <strong>^(Titel|Title)<t:s>$book.title:=       (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>^Autor|^Verfasser<t:s>$book.author:=      (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>^Ort<t:s>$book.location:=      (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>^Verlag<t:s>$book.publisher:=  (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>^Jahr<t:s>$book.year:=         (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>ISBN<t:s>$book.isbn:=         (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]</t:s></strong>
      <strong>{$book(. || "!") := (./following-sibling::*[1] | ./following-sibling::text())[normalize-space(.)][1]/(if (exists(@href) and contains(@href, '://')) then x'{.} ( {@href} )' else .)}</strong>
    </template:switch></template:loop>
    </td>
    </table>
  </template:switch>
</div>
</html>