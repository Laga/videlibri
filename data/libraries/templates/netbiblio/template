<?xml version="1.0" encoding="UTF-8"?>
<actions>

<meta>
  <description>Template f√ºr das NetBiblio-System</description>
  <variable name="baseurl"><description>Web-URI der Bibliothek</description></variable>  
</meta>


<action id="connect"></action>

<action id="internal-login"> 
  <page url="{$baseurl}/account/login">
    <post name="Username" value="{$username}"/>
    <post name="Password" value="{$password}"/>
  </page>
  <pattern><body><div class="alert alert-danger">{vl:raise(.)}</div>?</body></pattern>
</action>

<action id="update-all">
  <call action="internal-login"/>
  <s>vl:delete-current-books()</s>
  <page url="{$baseurl}/account/circulations?sort=Circulations.DueDate&page=1&pageSize=100000" templateFile="list"/>
  <page url="{$baseurl}/account/orders" templateFile="listOrders"/>
</action>

<action id="renew-list">
</action>



<action id="cancel-list">
</action>









<action id="search">
  <s>
    search-keys := {"author": "Person", "title": "T", "keywords": "Thema", "isbn": "I"},
    tempcount := 0,
    request := {
    "url": $baseurl || "/search/extended/submit",
    "method": "POST",
    "post": join((for $key in jn:keys($book) return if (boolean($book($key)) and exists($search-keys($key))) then (
         "Request.SearchTerm=" || uri-encode($book($key)),
         "Request.SearchField=" || uri-encode($search-keys($key)),
         "Request.SearchOperator=AND",
         (tempcount := $tempcount + 1)[0]
         ) else (), 
         for $filler in 1 to 2 - $tempcount return ("Request.SearchTerm=", "Request.SearchField=W", "Request.SearchOperator=AND"[$tempcount = 0]), (:500 error without 2 search terms:)
         if (boolean($book.year)) then (
           "Filter.StartDate="||$book.year,
           "Filter.EndDate="||$book.year
         ) else ()  ), $amp)
  }</s>
  <page url="{$request}" templateFile="searchList"/>
</action>

<action id="search-next-page"> 
  <page url="{$next-page}" templateFile="searchList"/>
</action>


<action id="search-details">
  <page url="{$book._detailUrl}" templateFile="searchDetails"/>
</action>




<action id="order-single">
</action>


<action id="catalogue">
  <variable name="url" value="{$baseurl}"/>
</action>



</actions>
