<template:meta encoding="utf8"/>
<t:switch>
<html>

<template:read var="templateError" source="'false'"/>

<template:switch>
<TD>Ausgeliehene Medien:<template:read var="delete-current-books()"/><template:read var="bookCount" source="filter(text(),'\d+')"/></TD>
<TD>keine Medien entliehen<template:read var="delete-current-books()"/><template:read var="bookCount" source="'0'"/></TD>
<TD>Sie haben keine Medien entliehen<template:read var="delete-current-books()"/><template:read var="bookCount" source="'0'"/></TD>
<TD>Sie haben keine Medien ausgeliehen<template:read var="delete-current-books()"/><template:read var="bookCount" source="'0'"/></TD>
</template:switch>

<template:if test="$bookCount;!='0'">
<template:read var="templateError" source="'true'"/>
<TABLE>
<TR>
<TH></TH><TH>Fällig</TH><TH>V</TH><TH>M</TH><TH>Signatur</TH><TH></TH><TH>Status</TH>
</TR>

<template:loop>
<TR>
{book:=object(("select(new)", ""))}
<input type="checkbox" template:optional="true"><template:read var="book.extendId" source="@name"/></input>
<TD align="center"><template:read var="book.limitDate" source="parse-date(.,'dd.mm.yyyy')"/></TD>
<TD><template:read var="V" source="."/><t:s test="$V; = ''">V:=0</t:s></TD>
<TD></TD>
<TD><template:read var="book.id" source="translate(.,' ','')"/></TD>
<TD></TD>
<TD><template:read var="status" source="deep-text()"/></TD>
<template:if test="$book.extendId;!=''">
<template:read var="book.status:curious" source="concat($V;, '-mal verlängert, ', $status;)"/>
</template:if>
<template:if test="$book.extendId;=''">
<template:read var="book.status:problematic" source="concat($status, ', ', $V;, '-mal verlängert')"/>
</template:if>
<template:read var="templateError" source="'false'"/>
</tr>
</template:loop>
</table>
</template:if>

<template:if test="$templateError;">Template Fehler! Vielleicht hat die Bücherei ihr System geändert.</template:if>
</html>
<html>
<title>Status</title>
<font color="red"><b><t:read var="raise()" source="deep-text()"/></b></font>
</html>
</t:switch>