<DIV class="aDISMaske"><!-- this page shows the books, but not if they are renewable. need to click on a button for that -->
<template:meta default-text-matching="regex"/>  
 <t:switch prioritized="true">
  <FORM>
  {form := .}
  
  <t:switch-prioritized>
    <input title="Zurück zur vorherigen Seite">{backButtonName := uri-encode(@name)}</input>
    <input t:condition="contains(@title, 'zur vorherigen Seite')">{backButtonName := uri-encode(@name)}</input>
  </t:switch-prioritized> 
   
   
  <DIV class="fsgrp">
    <t:if test="$mode = 'lend'">{
      extendFormPost := form($form, jn:object(($form//input[@type = "submit" and contains(@value, "arkierte") and contains(@value, "ngern")])[1]/{string(@name): @value})),
      extendFormPost.post := replace($extendFormPost.post, "[a-zA-Z0-9]+=on&", ""),
      goBackPage := form($form),
      goBackPage.post := x"{$goBackPage.post}&{$backButtonName}.x=0&{$backButtonName}.y=0"
    }</t:if>
    <t:else>{
      cancelFormPost := form($form, jn:object(($form//input[@type = "submit" and contains(@value, "arkierte") and contains(@value, "schen")])[1]/{string(@name): @value})),
      cancelFormPost.post := replace($cancelFormPost.post, "[a-zA-Z0-9]+=on&", ""),
      goBackPage := form($form),
      goBackPage.post := x"{$goBackPage.post}&{$backButtonName}.x=0&{$backButtonName}.y=0"
    }</t:else>
    
      
    <DIV class="rTable_div">
    <TABLE class="rTable_table">
    {hasTill := false()}
    <thead> 
      <th>Bis<t:s>hasTill := true()</t:s></th>?
    </thead>
      
  
    
    <t:loop>
    <TR>
    <TD>{
      book := {"_mode": $mode},
      if ($mode = "lend") then (book.extendid := encode-for-uri(input/@name), book._splitIndex := $splitIndex )
      else if ($mode = ("ordered", "requested", "provided","orderedMagazine")) then book.cancelid := encode-for-uri(input/@name)
      else (),
      if ($mode = "provided") then book.statusId := "provided"
      else ()      
    }</TD>
    <t:if test="$mode='lend'"> <TD>{
      if (contains(., "-")) then (book.issuedate := parse-date(substring-before(., "-"), "dd.mm.yyyy"), book.duedate := parse-date(substring-after(., "-"), "dd.mm.yyyy"))
      else book.duedate := parse-date(., "dd.mm.yyyy")
    }</TD> </t:if>
    <t:if test="$hasTill"> <TD>{
      if (contains(., ".")) then book.duedate := parse-date(., "dd.mm.yyyy") 
      else ()}
      <!-- vormerkungs verfall --></TD> </t:if>
    <TD>{book.libraryBranch := .}</TD>
    <TD>{book.category := extract(text(), "^ *\[([^\]]*)\]", 1),  
         book.title :=  if (starts-with(text(), "[")) then extract(text(), "(\] )(.*)", 2) else text(),
         if (contains($book.title, "/")) then (
           $book.author := substring-after($book.title, "/"),
           $book.title := substring-before($book.title, "/")
         ) else ()
         }
         <t:if test="./br">
          {book.id := string-join(./br/following-sibling::text(), ":")}
         </t:if>
    </TD>
    <t:if test="$mode != 'provided'">
    <TD>{book.status := deep-text("   "),
         book.renewCount := extract($book.status, "([0-9]+) *Verlängerung", 1)
        }
        <t:if test="matches(., x'((nicht +verl.*ngerbar|Keine Verl.*gerung +m.*glich|Vormerkungen).*Stand +{string-join(reverse(tokenize(current-date(), '-')), '[.]')})|((Max. +)?Anzahl +der +Verl.*erreicht)','i')">
          {book.statusId := "critical"}
        </t:if>
        <t:if test="$mode=('ordered', 'orderedMagazine')">{book.statusId := "ordered"}</t:if>
        <t:if test="$mode='requested'">{book.status := concat("vorgemerkt am ", $book.status), book.statusId := "ordered"}</t:if>
    </TD>
    </t:if>
    
    </TR>
    </t:loop>
    </TABLE>

  </DIV>
  </DIV>


  </form>
  
  
   
  <FORM>
    {form := .}
    
    <span class="txtinsert">((Mein Konto */|Benutzerkonto) +Ausleihen)|Benutzerkonto:? Übersicht</span>

    <t:switch-prioritized>
      <input title="Zurück zur vorherigen Seite">{backButtonName := uri-encode(@name)}</input>
      <input t:condition="contains(@title, 'zur vorherigen Seite')">{backButtonName := uri-encode(@name)}</input>
    </t:switch-prioritized> 
    {goBackPage := form($form),
    goBackPage.post := x"{$goBackPage.post}&{$backButtonName}.x=0&{$backButtonName}.y=0"}

    <div id="R06">
     <div>
      <div class="rTable_div">       
       <table class="rTable_table">
       <tr>
         <th>Anzahl</th>
         <th>Darstellung</th>
       </tr>
       <tr><td/><td>Keine Ausleihen in:|Ausleihen zeigen oder verlängern in:</td></tr>
       {nextSplitTable := (.//a/@href)[$splitIndex], splitCount := count(.//a)}
       </table>
    </div></div></div>
  </form>
  </t:switch>
</div>