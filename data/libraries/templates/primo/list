<html>
{$orderPage := ""}
<DIV class="EXLMyAccountContainer" id="exlidMyAccountContainer">
  <a t:condition="contains(@href, 'activity=requests')">{$orderPage := resolve-html(.)}</a>?
  <DIV class="EXLMyAccountMainContainer">
    <TABLE class="EXLMyAccountTable">
      <t:loop>
        <TR>
          <TD/><!--number-->
          <TD>{$book := {}}<input>{$book._renewLoanId := @value}</input>?</TD>
          <TD>{$book.title := ., let $href := ./a/@href return ($book._detailUrl := resolve-uri($href), $hold := contains($href, "type=hold"))}</TD>
          <TD>{$book.author}</TD>
          <t:if test="$hold">
          <TD>{$temp := if (contains(., "Bereitgestellt")) then "provided" else "ordered",
               let $till := extract(., "\d+/\d+/\d+") return if ($till) then $book.dueDate := parse-date($till, "dd/mm/yyyy") else ()}</TD>
          <TD>{$book.status := ., $book.statusId := $temp}</td>
          <TD>
          {if (./a) then book._cancelUrl := resolve-uri(./a/@href) else ()}
          </TD>
          </t:if>
          <t:else>
           <TD>{$book.dueDate := parse-date(., "dd.mm.yyyy")}</TD>
           <TD>{let $split := extract(normalize-space(), "([^0-9]+)( (.+)*|$)", (1,3)) return (
              $book.libraryBranch := $split[1], $book.id := $split[2])}</td>
           <TD>
           {if (./a) then (book.statusId := "curious", book._renewUrl := resolve-uri(./a/@href))
            else (book.status := ., book.statusId := "critical")}
           </TD>
          </t:else>
        </Tr>
      </t:loop>
    </TABLE>
  </DIV>
</DIV>
</html>