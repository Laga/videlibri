<?xml version="1.0" encoding="UTF-8"?>
<actions>
<!--https://kataloge.uni-hamburg.de/loan/DB=1/LNG=DU/SID=28a05a0c-0/USERINFO_LOGIN-->

<action id="connect">
 <!-- <page url="https://kataloge.uni-hamburg.de:443/loan/DB=1/USERINFO" templateFile="start">
    <post name="ACT" value="UI_DATA"/>
    <post name="HOST_NAME"/>
    <post name="HOST_PORT"/>
    <post name="HOST_SCRIPT"/>
    <post name="LOGIN" value="KNOWNUSER"/>
    <post name="STATUS" value="HML_OK"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
  </page>-->
  <variable name="loanServer" value="{$server}/loan/DB=1/LNG=DU/"/>
</action>

<action id="update-all">
 <!-- <page url="https://kataloge.uni-hamburg.de/loan/DB=1/USERINFO?ACT=UI_LOL" > 
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW_ENC" value="{$pw_enc}"/>
  </page>-->
  <page url="{$loanServer}/USERINFO" templateFile="update"> 
    <post name="ACT" value="UI_LOL"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
  </page>
</action>

<action id="renew-list">
  <variable name="book-list">string-join(for $book in $renew-books return x"VB={$book.extendId}", "&amp;")</variable> 
  <page url="{$loanServer}/USERINFO" templateFile="extend">
    <post name="ACT" value="UI_RENEWLOAN"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
    <post value="{$book-list}"/>
  </page>
</action>




<action id="search">
  <variable name="searchOptions">
  encode-for-uri( string-join(
    (if ($book.title != "")    then concat("tit ", $book.title)    else (),
     if ($book.author != "")   then concat("prs ", $book.author)   else (),
     if ($book.isbn != "")     then concat("isb ", $book.isbn)     else (),
     if ($book.year != "")     then concat("jah ", $book.year)     else (),
     if ($book.keywords != "") then concat("slw ", $book.keywords) else ()), "&amp;"))
  </variable>


  <page url="{$server}/CMD?ACT=SRCHA&IKT=1016&SRT=RLV&TRM={$searchOptions}" templateFile="searchList"></page>
  
  <page test="$singleResult" url="{$server}/CMD?ACT=SRCHA&IKT=1016&SRT=RLV&TRM={$searchOptions}" templateFile="searchDetails"></page>

  <variable name="i">0</variable>
  <loop test="$nextPage != '' and $i < 10">
    <page url="{$nextPage}" templateFile="searchList"></page>
    <variable name="i">$i + 1</variable>
  </loop>
    
</action>

<action id="searchDetails">
  <page url="{$book.home-url}" templateFile="searchDetails"></page>
</action>

</actions> 
