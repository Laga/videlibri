<?xml version="1.0" encoding="UTF-8"?>
<actions>
<!--https://kataloge.uni-hamburg.de/loan/DB=1/LNG=DU/SID=28a05a0c-0/USERINFO_LOGIN-->

<action id="connect">
 <!-- <page url="https://kataloge.uni-hamburg.de:443/loan/DB=1/USERINFO" templateFile="start">
    <post name="ACT" value="UI_DATA"/>
    <post name="HOST_NAME"/>
    <post name="HOST_PORT"/>
    <post name="HOST_SCRIPT"/>
    <post name="LOGIN" value="KNOWNUSER"/>
    <post name="STATUS" value="HML_OK"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
  </page>-->
  <variable name="db" value="DB={get('picadb', 1)}"/>
  <variable name="loanServer" value="{$server}/loan/{$db}/LNG=DU/"/>
</action>

<action id="update-all">
 <!-- <page url="https://kataloge.uni-hamburg.de/loan/DB=1/USERINFO?ACT=UI_LOL" > 
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW_ENC" value="{$pw_enc}"/>
  </page>-->
  <variable name="reservations"/>
  <page url="{$loanServer}/USERINFO" templateFile="update"> 
    <post name="ACT" value="UI_LOL"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
  </page>
  <page url="{$reservations}" templateFile="updateReservations"/> 
</action>

<action id="renew-list">
  <variable name="book-list">string-join(for $book in $renew-books return x"VB={$book.extendId}", "&amp;")</variable> 
  <page url="{$loanServer}/USERINFO" templateFile="extend">
    <post name="ACT" value="UI_RENEWLOAN"/>
    <post name="BOR_U" value="{$username}"/>
    <post name="BOR_PW" value="{$password}"/>
    <post value="{$book-list}"/>
  </page>
</action>




<action id="search">
  
  <variable name="searchKeys">
  tokenize(get("searchKeysOverride", "tit;prs;isb;jah;slw"), ";")
  </variable>
  
  <variable name="searchOptions">
  encode-for-uri( string-join(
    (if ($book.title != "")    then concat($searchKeys[1], " ", $book.title)    else (),
     if ($book.author != "")   then concat($searchKeys[2], " ", $book.author)   else (),
     if ($book.isbn != "")     then concat($searchKeys[3], " ", $book.isbn)     else (),
     if ($book.year != "")     then concat($searchKeys[4], " ", $book.year)     else (),
     if ($book.keywords != "") then concat($searchKeys[5], " ", $book.keywords) else ()), "&amp;"))
  </variable>


  <page url="{$server}/{$db}/CMD?ACT=SRCHA&IKT=1016&SRT=RLV&TRM={$searchOptions}" templateFile="searchList"></page>
  
  <page test="$singleResult" url="{$server}/{$db}/CMD?ACT=SRCHA&IKT=1016&SRT=RLV&TRM={$searchOptions}" templateFile="searchDetails"></page>
  
  <variable name="search-next-page-available">$nextPage</variable>
</action>

<action id="search-next-page">
  <page url="{$nextPage}" templateFile="searchList"></page>

  <variable name="search-next-page-available">$nextPage</variable>
</action>


<action id="search-details">
  <page url="{$book.home-url}" templateFile="searchDetails"></page>
</action>

<action id="catalogue">
  <variable name="db" value="DB={get('picadb', 1)}"/>
  <variable name="url" value="{$server}/{$db}/LNG=DU/"/>
</action>

</actions> 
