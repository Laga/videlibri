<html>

<template:meta default-text-matching="regex"/>
<t:s>curAuthor := (), sigid := 0, book.orderable := 0</t:s> <!-- extra variable to prevent contamination by previously set book.author -->


<table summary="Main layout">
  
  <template:switch-prioritized>
  
  <table t:condition="exists((. | ./tbody)/tr/td[contains(@class, 'preslabel')])">
  <template:loop><template:switch>
    <tr>
      <td><strong>^[ ]*Titel:</strong></td>
      <td>{book.title := filter(deep-text(''), '[^/]+')}</td>
    </tr>
    
    <tr>
      <td><strong>Verfasser|Personen</strong></td>
      <td>{curAuthor := ($curAuthor, filter(deep-text(''), '[^*]+') ),
           book.author := string-join($curAuthor, "; ")}</td>
    </tr>
    
    <tr>
      <td><strong>ISBN:</strong></td>
      <td>{$book.isbn := text()}</td>
    </tr>

    <tr>
      <td><strong>PPN:</strong></td>
      <td><a>{$book.home-url := if (contains(@href, "://")) then @href else concat($base,"/",@href)}</a></td>
    </tr>
    
    <tr>
      <td><strong>Zeitschrift:</strong></td>
      <td>{temp := deep-text(""),
           book.title := concat(if (contains($temp, ":")) then substring-before($temp, ":") else $temp, 
                                if (contains($book.id, "-")) then concat(" [",substring-after($book.id, "-"), "]") else ""),
           book.author := if (contains($temp, "/")) then x"{substring-after(normalize-space($temp), "/")} (Zeitschrift)" else "Zeitschrift"}</td>
    </tr>

    <tr>
      <td><strong>KÃ¶rperschaft:</strong></td>
      <td>{if ($book.author = "Zeitschrift") then book.author := concat(., " (Zeitschrift)") else ()}</td>
    </tr>
    
    
    <tr>
      <td><strong>Standort:</strong></td>
      <td><t:read var="book.Standort {$sigid + 1}!" source="."/></td>
    </tr>

    <tr>
      <td><strong>Signatur:</strong></td>
      <td>{sigid := $sigid + 1}<t:read var="book.Signatur {$sigid}!" source="."/></td>
    </tr>
    
    <tr>
      <td><strong>Ausleihstatus:</strong></td>
      <td><t:read var="book.Ausleihstatus {$sigid}!" source="string-join(div/text(), '; ')"/>
        <script><t:read var="book.orders{$book.orderable}" source="extract(., '(/loan[^'']*)\''', 1)"/><!-- source="extract(., '(/loan.*)LOGIN', 1)"/> -->
                <t:read var="book.ordersTitle{$book.orderable}" source="concat($book(x'Standort {$sigid}!'), ' ',$book(x'Signatur {$sigid}!') )"/> 
                {book.orderable := $book.orderable + 1}</script>?</td>
    </tr>
    
    <tr>
      <td><strong>{propname := filter(translate(normalize-space(.), ".", ""), "[^:]+")}</strong></td>
      <td><t:if test="$propname != ''"><t:read var="book.{$propname}!" source="."/></t:if></td>
    </tr>
  </template:switch></template:loop>
  {book.stabikatFound := true()}
  </table>
  
  <strong>Leider keine Treffer.<t:s>book.title := x"??? (Keine Ergebnisse bei einer Suche nach {$book.id} im StaBiKat)", book.author := "???", book.stabikatFound := false()</t:s></strong>
  
  </template:switch-prioritized>
  
  <img t:condition="contains(@src, 'permalink')">  <!-- permalink.gif, or permalink_du.gif, ... -->
  {book.home-url:=if (contains(../@href, "://")) then ../@href else concat($base,"/",../@href)}
  </img>?
  
  
</table>



</html>
