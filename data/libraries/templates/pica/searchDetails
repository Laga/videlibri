<html>

<template:meta default-text-matching="regex"/>
<t:s>curAuthor := ()</t:s> <!-- extra variable to prevent contamination by previously set book.author -->


<table summary="Main layout">
  
  <template:switch-prioritized>
  
  <table t:condition="exists((. | ./tbody)/tr/td[contains(@class, 'preslabel')])">
  <template:loop><template:switch>
    <tr>
      <td><strong>^[ ]*Titel:</strong></td>
      <td>{book.title := filter(deep-text(''), '[^/]+')}</td>
    </tr>
    
    <tr>
      <td><strong>Verfasser|Personen</strong></td>
      <td>{curAuthor := ($curAuthor, filter(deep-text(''), '[^*]+') ),
           book.author := string-join($curAuthor, "; ")}</td>
    </tr>
    
    <tr>
      <td><strong>ISBN:</strong></td>
      <td>{$book.isbn := text()}</td>
    </tr>
    
    <tr>
      <td><strong>Zeitschrift:</strong></td>
      <td>{book.title := concat(if (contains(deep-text(""), ":")) then substring-before(deep-text(""), ":") else deep-text(""), 
                                if (contains($book.id, "-")) then concat(" [",substring-after($book.id, "-"), "]") else ""),
           book.author := "Zeitschrift"}</td>
    </tr>
    
    <tr>
      <td><strong>{propname := filter(translate(normalize-space(.), ".", ""), "[^:]+")}</strong></td>
      <td><t:if test="$propname != ''"><t:read var="book.{$propname}!" source="."/></t:if></td>
    </tr>
  </template:switch></template:loop>
  {book.stabikatFound := true()}
  </table>
  
  <strong>Leider keine Treffer.<t:s>book.title := x"??? (Keine Ergebnisse bei einer Suche nach {$book.id} im StaBiKat)", book.author := "???", book.stabikatFound := false()</t:s></strong>
  
  </template:switch-prioritized>
  
  <a target="_blank"><img t:condition="contains(@src, 'permalink')"/>  <!-- permalink.gif, or permalink_du.gif, ... -->
  {book.home-url:=if (contains(@href, "://")) then @href else concat($base,"/",@href)}
  </a>?
  
  
</table>



</html>
