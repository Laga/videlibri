<?xml version="1.0" encoding="UTF-8"?>
<html>
<t:switch-prioritized>
<body>
 <a t:condition="contains(@href, 'MEMSTAT')">{$new-update-page := @href}</a>?

 <fieldset><div class='MemStatMembCapt'>
    <template:read var="delete-current-books()"/>
    <template:read source="false()" var="bookTableBroken"/>
    {hasShelfMark := false()}
 </div></fieldset>

 <form name="MEMISSIT" template:optional="true">
   <template:read source="true()" var="bookTableBroken"/>
   <fieldset id="issued_items">
     
     <table>
       <template:read source="true()" var="noExtendingPossible"/>
       <thead><tr><th  class="barcode" abbr="bc" ></th>
                  <th  abbr="tit" ></th>
                  <th  class="author" abbr="aut" ></th>
                  <th  class="callNumber" abbr="cn">{$hasShelfMark := true()}</th>?
                  <th  class="dueDate" abbr="due" ></th>
                  <th  class="numRenewals" abbr="num" ></th>
                  <th  class="renew" abbr="ren"  template:optional="true">
                    <template:read source="false()" var="noExtendingPossible"/>
                  </th></tr></thead>
                  
       <template:loop> 
       <tr>
          {book := object()}
          <template:read source="false()" var="bookTableBroken"/>
          <template:read var="book.extendid" source="''"/>
          <th class="barcode" headers="th1_1"><template:read source="." var="book.id"/></th>
          <td headers="th1_2">
            <template:read source="text()" var="book.title"/>
            <span class='ItemNotesLeader' t:optional=true/>
            <br template:optional="true"/>
            <template:read source="text()" var="temporaryStatusDetails"/>
          </td>
          <td headers="th1_3"><template:read source="." var="book.author"/></td>
          <td t:test="$hasShelfMark"/>
          <td><template:read source="." var="book.duedate:d mmm yyyy"/></td>
          <td><template:read source="concat('bisher ',., ' mal verlängert')" var="book.status:curious"/></td>
          <td template:optional="true" t:condition="input">
            <input><template:read var="book.extendid" source="@name"/></input>
          </td>
          <template:if test="$book.extendid=''">
            <template:read var="book.status:problematic" source="$temporaryStatusDetails"/>
          </template:if>
          <template:if test="$noExtendingPossible">
            <template:read var="book.status:problematic" source="'Prinzipiell keine Verlängerung möglich'"/>
          </template:if>
       </tr>
       </template:loop>
     </table>

     <input type="hidden" name="mid">
       <template:read var="mid" source="@value"/>
     </input>
  </fieldset>
 </form>
 
 
 <form name="MEMSLFRES" template:optional="true">
   {cancelForm := form(.)}
   <fieldset id="reserved_items_flds">     
     <table>
       
       <thead><tr> 
                  <th class="barcode" abbr="bc" ></th>
                  <th abbr="tit" ></th>
                  <th class="author" abbr="aut" ></th>
                  <th class="reserveDate" abbr="date" ></th>
                  <th class="delete" abbr="del" ></th>
              </tr></thead>
                  
       <template:loop>
       <tr>
          {book := {"statusId": "ordered"}}
          <td headers='th7_2'>{$book.id}</td>
          <td headers='th7_3'>{$book.title}</td>
          <td headers='th7_4'>{$book.author}</td>
          <td headers='th7_5'>{$book.issueDate := parse-date(., "d mmm yyyy")}</td>
          <td headers='th7_6'><input type="checkbox">{book.cancelId := uri-combine(., ())}</input>?</td>
       </tr>
       <!--<template:read var="book-end()"/>-->
       </template:loop>
     </table>

     <input type="hidden" name="mid">
       <template:read var="mid" source="@value"/>
     </input>
  </fieldset>
 </form> 
</body>


<form>
  <template:meta default-text-matching="regex"/>
  Systemmeldung|System Nachricht|Exception Message
  <template:read source="false()" var="bookTableBroken"/>
  <p>Ihre Anforderung konnte|Your process</p>
  <blockquote>
    <ul><template:read var="raise()" source="deep-text()"/></ul>
  </blockquote>
</form>

</t:switch-prioritized>

<template:if test="$bookTableBroken">
  <BOOKTABLEBROKEN>
  Probably site layout changed!
  </BOOKTABLEBROKEN>
</template:if>
</html>
